---
name: DataTable
route: /data-table
---

import { useCallback, useState, useRef } from 'react'
import { DataTable } from '../core/DataTable/DataTable.tsx'
import { RowMode }  from '../core/DataTable/types'
import { DataTableAction } from '../core/DataTable/DataTableAction'
import Button from '../core/Button'
import { Playground, Props } from 'docz'
import {
    Delete as DeleteIcon,
    Edit as EditIcon,
    Save as SaveIcon,
    Cancel as CancelIcon,
    Check as CheckIcon
} from '../icons'
import format from 'date-fns/format'

# DataTable

## Properties

<Props of={ DataTable } />

## `pagination`

```typescript
type PaginationOptions = {
    rowsPerPage: number
    labelRowsPerPage: string
    labelDisplayedRows:
        (param: { from: number, to: number, count: number }) => string
    rowsPerPageOptions: number[],
    showFirstButton?: boolean
    showLastButton?: boolean
    disabled: boolean
}
```

Default values

```
const defaultPagination: PaginationOptions = {
    rowsPerPage: 10,
    labelRowsPerPage: 'Rows per page:',
    labelDisplayedRows: ({ from, to, count }) => {
        return `${from}-${to} of ${count !== -1 ? count : `more than ${to}`}`
    },
    disabled: false,
    showFirstButton: false,
    showLastButton: false,
    rowsPerPageOptions: [5, 10, 20]
}
```

## Simple

<Playground>
    {
        () => {
            const date = () => new Date()
            const randomId = () => Math.random().toString(36).substr(0,12)
            const [data,setData] = useState([
                {id: 1, product: 'Magazine Magazine Magazine', price: 13.50, quantity: 12, date: date()},
                {id: 2, product: 'Table', price: 200.49, quantity: 3, date: date()},
                {id: 3, product: 'Chair', price: 53.50, quantity: 9, date: date()},
                {id: 4, product: 'Keyboard', price: 53.29, quantity:4, date: date()},
                {id: 5, product: 'Mouse', price: 27.13, quantity: 16, date: date()},
                {id: 6, product: 'Microphone', price: 89.14, quantity: 2, date: date()},
                {id: 7, product: 'Headset', price: 117.85, quantity: 6, date: date()},
                {id: 8, product: 'Pencil', price: 1.50, quantity: 11, date: date()}
            ])

            const columns = [{
                title: 'Product',
                field: 'product',
                cellStyle: {
                    maxWidth: '72px',
                    whiteSpace: 'nowrap',
                    overflow: 'hidden',
                    textOverflow: 'ellipsis' 
                },
                editable: true
            }, {
                title: 'Price (R$)',
                field: 'price',
                type: 'numeric-float',
                editable: false,
                getValue: value => value.toFixed(2).replace('.',',')
            }, {
                title: 'Quantity',
                field: 'quantity',
                type: 'numeric-int',
                editable: true,
                cellStyle: {
                    width: '82px'
                }
            }, {
                title: 'Date',
                field: 'date',
                type: 'datetime',
                editable: true,
                getValue: value => format(value,'dd/MM/yyyy HH:mm'),
                cellStyle: {
                    width: '200px'
                }
            }]

            return (
                <DataTable                    
                    data={ data }
                    pagination={ {
                        rowsPerPage: 5,
                        labelRowsPerPage: 'Row per page'
                    } }
                    columns={ columns }
                />
            )
    }}
</Playground>

## Empty

<Playground>
    {
        () => {
            const columns = [{
                title: 'Product',
                field: 'product',
                cellStyle: {
                    maxWidth: '72px',
                    whiteSpace: 'nowrap',
                    overflow: 'hidden',
                    textOverflow: 'ellipsis' 
                },
                editable: true
            }, {
                title: 'Price (R$)',
                field: 'price',
                type: 'numeric-float',
                editable: false,
                getValue: value => value.toFixed(2).replace('.',',')
            }]

            const componentForEmpty = (
                <tr>
                    <td style={{ 
                        display: 'flex',
                        position: 'absolute',
                        height: '100%',
                        width: '100%',
                        justifyContent: 'center',
                        alignItems: 'center',
                        boxSizing: 'border-box'
                    }}>
                        <div>Empty DataTable</div>
                    </td>
                </tr>
            )

            return (
                <DataTable                    
                    data={ [] }
                    bodyStyle={ { position: 'relative' } }
                    hiddenRowHeight={ 53 }
                    componentForEmpty={ componentForEmpty }
                    pagination={ {
                        rowsPerPage: 5,
                        labelRowsPerPage: 'Row per page'
                    } }
                    columns={ columns }
                />
            )
    }}
</Playground>

## No header

<Playground>
    {
        () => {
            const date = () => new Date()
            const randomId = () => Math.random().toString(36).substr(0,12)
            const [data,setData] = useState([
                {id: 1, product: 'Magazine Magazine Magazine', price: 13.50, quantity: 12, date: date()},
                {id: 2, product: 'Table', price: 200.49, quantity: 3, date: date()},
                {id: 3, product: 'Chair', price: 53.50, quantity: 9, date: date()},
                {id: 4, product: 'Keyboard', price: 53.29, quantity:4, date: date()},
                {id: 5, product: 'Mouse', price: 27.13, quantity: 16, date: date()},
                {id: 6, product: 'Microphone', price: 89.14, quantity: 2, date: date()},
                {id: 7, product: 'Headset', price: 117.85, quantity: 6, date: date()},
                {id: 8, product: 'Pencil', price: 1.50, quantity: 11, date: date()}
            ])

            const columns = [{
                title: 'Product',
                field: 'product',
                cellStyle: {
                    maxWidth: '72px',
                    whiteSpace: 'nowrap',
                    overflow: 'hidden',
                    textOverflow: 'ellipsis' 
                },
                editable: true
            }, {
                title: 'Price (R$)',
                field: 'price',
                type: 'numeric-float',
                editable: false,
                getValue: value => value.toFixed(2).replace('.',',')
            }, {
                title: 'Quantity',
                field: 'quantity',
                type: 'numeric-int',
                editable: true,
                cellStyle: {
                    width: '82px'
                }
            }, {
                title: 'Date',
                field: 'date',
                type: 'datetime',
                editable: true,
                getValue: value => format(value,'dd/MM/yyyy HH:mm'),
                cellStyle: {
                    width: '200px'
                }
            }]

            return (
                <DataTable                    
                    data={ data }
                    noHeader
                    hiddenRowHeight={ 53 }
                    pagination={ {
                        rowsPerPage: 5,
                        labelRowsPerPage: 'Row per page'
                    } }
                    columns={ columns }
                />
            )
    }}
</Playground>


## No pagination

<Playground>
    {
        () => {
            const date = () => new Date()
            const randomId = () => Math.random().toString(36).substr(0,12)
            const [data,setData] = useState([
                {id: 1, product: 'Magazine Magazine Magazine', price: 13.50, quantity: 12, date: date()},
                {id: 2, product: 'Table', price: 200.49, quantity: 3, date: date()},
                {id: 3, product: 'Chair', price: 53.50, quantity: 9, date: date()},
                {id: 4, product: 'Keyboard', price: 53.29, quantity:4, date: date()},
                {id: 5, product: 'Mouse', price: 27.13, quantity: 16, date: date()},
                {id: 6, product: 'Microphone', price: 89.14, quantity: 2, date: date()},
                {id: 7, product: 'Headset', price: 117.85, quantity: 6, date: date()},
                {id: 8, product: 'Pencil', price: 1.50, quantity: 11, date: date()}
            ])

            const columns = [{
                title: 'Product',
                field: 'product',
                cellStyle: {
                    maxWidth: '72px',
                    whiteSpace: 'nowrap',
                    overflow: 'hidden',
                    textOverflow: 'ellipsis' 
                },
                editable: true
            }, {
                title: 'Price (R$)',
                field: 'price',
                type: 'numeric-float',
                editable: false,
                getValue: value => value.toFixed(2).replace('.',',')
            }, {
                title: 'Quantity',
                field: 'quantity',
                type: 'numeric-int',
                editable: true,
                cellStyle: {
                    width: '82px'
                }
            }, {
                title: 'Date',
                field: 'date',
                type: 'datetime',
                editable: true,
                getValue: value => format(value,'dd/MM/yyyy HH:mm'),
                cellStyle: {
                    width: '200px'
                }
            }]

            return (
                <DataTable                    
                    data={ data }
                    hiddenRowHeight={ 53 }
                    pagination={ {
                        disabled: true
                    } }
                    columns={ columns }
                />
            )
    }}
</Playground>

## CRUD

An example using the `controllerRef`, `errors` and `rowViews`

Some rules when adding a new row:
- The `price` and `quantity` must be greater than 0 (zero)
- The `date` must be before now

<Playground>
    {
        () => {
            const date = () => new Date()
            const controllerRef = useRef()
            const [errors, setErrors] = useState({})
            const randomId = () => Math.random().toString(36).substr(0,12)
            const [data,setData] = useState([
                {id: 1, product: 'Magazine', price: 13.50, quantity: 12, date: date()},
                {id: 2, product: 'Table', price: 200.49, quantity: 3, date: date()},
                {id: 3, product: 'Chair', price: 53.50, quantity: 9, date: date()},
                {id: 4, product: 'Keyboard', price: 53.29, quantity:4, date: date()},
                {id: 5, product: 'Mouse', price: 27.13, quantity: 16, date: date()},
                {id: 6, product: 'Microphone', price: 89.14, quantity: 2, date: date()},
                {id: 7, product: 'Headset', price: 117.85, quantity: 6, date: date()},
                {id: 8, product: 'Pencil', price: 1.50, quantity: 11, date: date()}
            ])

            const handleAdd = () => {
                controllerRef.current.addRow({ id: randomId(), date: date() })
            }

            const handleEdit = (id) => () => {
                controllerRef.current.editRow(id)
            }

            const handleDelete = (id) => () => {
                controllerRef.current.pushRowView(id, 'confirmDelete')
            }

            const handleView = (id) => () => {
                controllerRef.current.viewRow(id)
            }

            const isNullable = x => x == null
            const isNotPositive = x => x <= 0
            const isAfterNow = x => +x > +new Date()
            const isEmpty = x => x.trim().length === 0

            const handleErrors = (id, nextItem = {}, isPartial = false) => {
                let hasError = false
                const { quantity, date, product, price } = nextItem

                const errorFields =
                    [{field: 'quantity', isErrorIf: [isNaN,isNotPositive]},
                     {field: 'date', isErrorIf: [isAfterNow]},
                     {field: 'product', isErrorIf: [isEmpty]},
                     {field: 'price', isErrorIf: [isNaN,isNotPositive]}
                    ].filter(({field,isErrorIf}) => {
                        const value = nextItem[field]

                        if(isNullable(value)){
                            if(isPartial) return false
                            return true
                        }

                        return isErrorIf.some(cond => cond(value))
                    }).map(({ field }) => field)
                    
                setErrors(errors => ({
                    ...errors,
                    [id]: new Set(errorFields)
                }))

                return errorFields.length > 0
            }

            const handleSave = (id, isNew = false) => () => {
                const nextItem = controllerRef.current.getEditedRowData(id)

                if (!nextItem) return

                if (handleErrors(id, nextItem, !isNew)) {
                    return
                }

                if (isNew) {
                    setData(data => [nextItem, ...data])
                } else {
                    setData(data => data.map(item => {
                        if (item.id === id) {
                            return { ...item, ...nextItem }
                        }
                        return item
                    }))
                }

                controllerRef.current.viewRow(id)
            }

            const columns = [{
                title: 'Product',
                field: 'product',
                cellStyle: {
                    width: '120px'
                },
                editable: true
            }, {
                title: 'Price (R$)',
                field: 'price',
                type: 'numeric-float',
                editable: true,
                getValue: value => value.toFixed(2).replace('.',',')
            }, {
                title: 'Quantity',
                field: 'quantity',
                type: 'numeric-int',
                editable: true,
                cellStyle: {
                    width: '82px'
                }
            }, {
                title: 'Date',
                field: 'date',
                type: 'datetime',
                editable: true,
                getValue: value => format(value,'dd/MM/yyyy HH:mm'),
                cellStyle: {
                    width: '200px'
                }
            }, {
                title: 'Actions',
                type: 'actions',
                align: 'center',
                cellStyle: {
                    width: '60px'
                },
                renderCell: ({ data: { id }, rowMode, isNew = false }) => {
                    if (rowMode === RowMode.View) {
                        return (
                            <div style={ { display: 'flex' } }>
                                <DataTableAction label="Edit" onClick={ handleEdit(id) }>
                                    <EditIcon />
                                </DataTableAction>
                                <DataTableAction label="Delete" onClick={ handleDelete(id) }>
                                    <DeleteIcon />
                                </DataTableAction>
                            </div>
                        )
                    }

                    return (
                        <div style={{ display: 'flex' }}>
                            <DataTableAction label="Save" onClick={ handleSave(id, isNew) }>
                                <SaveIcon />
                            </DataTableAction>
                            <DataTableAction label="Cancel" onClick={ handleView(id) }>
                                <CancelIcon />
                            </DataTableAction>
                        </div>
                    )
                }
            }]

            const rowViews = {
                confirmDelete: ({ popRowView, data }) => {
                    return <td colSpan={ 5 }>
                        <div style={{display: 'flex', padding: '16px', justifyContent: 'space-between'}}>
                            <span>Confirm Delete "{data.product}"?</span>
                            <div style={{ display: 'flex' }}>
                                <DataTableAction label="CheckIcon" onClick={() => {
                                    controllerRef.current.popRowView(data.id)
                                    setData(dataList => dataList.filter(item => item.id !== data.id))
                                }}>
                                    <CheckIcon />
                                </DataTableAction>
                                <DataTableAction label="CancelIcon" onClick={() => {
                                    controllerRef.current.popRowView(data.id)
                                }}>
                                    <CancelIcon />
                                </DataTableAction>
                            </div>
                        </div>
                    </td>
                }
            }

            return (
                <>
                    <Button onClick={ handleAdd }>Add Row</Button>
                    <DataTable                    
                        data={ data }
                        controllerRef={ controllerRef }
                        errors={ errors }
                        pagination={ {
                            rowsPerPage: 5,
                            showFirstButton: true,
                            showLastButton: true,
                            labelRowsPerPage: 'Rows per page:',
                            labelDisplayedRows: ({ from, to, count }) => {
                                return `${from}-${to} of ${count !== -1 ? count : `more than ${to}`}`
                            },
                        } }
                        rowViews={ rowViews }
                        columns={ columns }
                    />
                </>
            )
    }}

</Playground>